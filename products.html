<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product — KeebCam</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .product-page { padding: 40px 28px; max-width:1100px; margin:0 auto; }
    .product-grid { display:flex; gap:28px; align-items:flex-start; flex-wrap:wrap; }
    .product-image { flex:1 1 420px; }
    .product-info { flex:1 1 360px; background:var(--glass); padding:18px; border-radius:12px; border:1px solid rgba(255,255,255,0.02); }
    .product-info h1{ margin:0 0 8px; }
    .specs{ margin:12px 0 0; padding:0; list-style:none; color:var(--muted); }
    .back-link{ display:inline-block; margin-top:14px; color:var(--muted); text-decoration:none; }

    /* Carousel styles */
    .carousel {
      position: relative;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    }

    .carousel-track {
      display: flex;
      transition: transform 320ms cubic-bezier(.2,.9,.2,1);
      will-change: transform;
    }

    .carousel-slide {
      min-width: 100%;
      box-sizing: border-box;
      user-select: none;
      -webkit-user-drag: none;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }

    .carousel-slide img {
      width: 100%;
      height: auto;
      max-height: 520px;
      object-fit: contain;
      border-radius: 10px;
      display:block;
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.45);
      border: none;
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 6;
      transition: background 160ms ease;
    }
    .carousel-btn:hover { background: rgba(0,0,0,0.6); }

    .carousel-btn.left { left: 10px; }
    .carousel-btn.right { right: 10px; }

    .carousel-dots {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 10px;
      display:flex;
      gap:8px;
      z-index:7;
    }

    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.18);
      cursor: pointer;
      transition: transform 160ms ease, background 160ms ease;
    }
    .carousel-dot.active {
      background: var(--accent);
      transform: scale(1.25);
    }

    /* Small screens */
    @media (max-width:720px){
      .carousel-slide img { max-height: 360px; }
      .carousel-btn { width:36px; height:36px; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">KeebCam</a>
      <nav class="nav">
        <a href="index.html#shop">Shop</a>
        <a href="index.html#about">About</a>
        <a href="index.html#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main class="product-page">
    <div id="productContainer" class="product-grid"></div>
    <div style="margin-top:28px;">
      <a class="back-link" href="index.html">← Back to shop</a>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>© <span id="year"></span> KeebCam.</small>
    </div>
  </footer>

  <script>
    const CONTACT_WHATSAPP_NUMBER = "85514975307";
    const TELEGRAM_HANDLE = "85514975307";
    const DISCORD_HANDLE = "Kokushibo#4764";

    // Product data (same as before) — now includes an images array for each product
    const products = [
      {
        id: "atk-edge60he",
        title: "ATK EDGE 60 HE",
        short: "60% esports magnetic keyboard; aluminum CNC case; PBT dye‑sublimation keycaps",
        price: 199,
        layout: "60",
        images: [
          "https://raw.githubusercontent.com/Glsswrks/keebcam/main/images/2_27ffe2b5-f717-4c2f-940c-959572442aa1.jpg",
          "https://raw.githubusercontent.com/Glsswrks/keebcam/main/images/ATK_Edge_60_Description_Desktop-14.jpg",
          "https://raw.githubusercontent.com/Glsswrks/keebcam/main/images/ATK_Edge_60_Description_Desktop-17.jpg"
        ],
        specs: ["60% (61 keys)","Full Aluminum CNC case","PBT dye‑sublimation keycaps","Hot‑swap / magnetic switches","8K Hz Polling rate","0.08ms Latency","256k scanning-rate","Precision 0.001mm","Super stable RT","Functions SOCD / DKS / RT / MT / TGL / Key remapping","Champion Preset","Cherry Profile Keycaps"]
      },
      {
        id: "made68-ultra",
        title: "MADE68 Ultra",
        short: "68‑key compact; premium aluminum case; Hall‑effect / magnetic switch features",
        price: 240,
        layout: "68",
        images: [
          "https://raw.githubusercontent.com/Glsswrks/keebcam/main/images/4ef591ca-b818-4e2b-ae0a-14b2cc81f9f3-1000x1000-peMUQzqEYVGLpdYu48cevRgENzP3G9OX3h2PuM0n.png",
          "https://raw.githubusercontent.com/Glsswrks/keebcam/main/images/made68-2.jpg"
        ],
        specs: ["68 keys","Aluminum alloy case","Magnetic / Hall effect switches","Premium finish"]
      }
    ];

    function getQueryParam(name){
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function whatsappLink(product){
      const base = `https://wa.me/${CONTACT_WHATSAPP_NUMBER.replace(/\D/g,'')}`;
      const text = encodeURIComponent(`Hi, I'm interested in ${product.title}. Is it available?`);
      return `${base}?text=${text}`;
    }

    function telegramLink(){
      return `https://t.me/${TELEGRAM_HANDLE}`;
    }

    // Carousel helper: creates DOM for carousel and wires interactions
    function createCarousel(images, containerIdPrefix = 'carousel') {
      const wrapper = document.createElement('div');
      wrapper.className = 'carousel';
      const track = document.createElement('div');
      track.className = 'carousel-track';

      images.forEach((src, i) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';
        const img = document.createElement('img');
        img.src = src;
        img.alt = `Product image ${i+1}`;
        slide.appendChild(img);
        track.appendChild(slide);
      });

      // Buttons
      const btnLeft = document.createElement('button');
      btnLeft.className = 'carousel-btn left';
      btnLeft.setAttribute('aria-label','Previous image');
      btnLeft.innerHTML = '&#9664;';

      const btnRight = document.createElement('button');
      btnRight.className = 'carousel-btn right';
      btnRight.setAttribute('aria-label','Next image');
      btnRight.innerHTML = '&#9654;';

      // Dots
      const dots = document.createElement('div');
      dots.className = 'carousel-dots';
      images.forEach((_, i) => {
        const d = document.createElement('div');
        d.className = 'carousel-dot';
        if(i === 0) d.classList.add('active');
        d.dataset.index = i;
        dots.appendChild(d);
      });

      wrapper.appendChild(track);
      wrapper.appendChild(btnLeft);
      wrapper.appendChild(btnRight);
      wrapper.appendChild(dots);

      // Interaction state
      let index = 0;
      let startX = 0;
      let currentTranslate = 0;
      let isDragging = false;
      const slidesCount = images.length;

      function update() {
        const width = wrapper.clientWidth;
        currentTranslate = -index * width;
        track.style.transform = `translateX(${currentTranslate}px)`;
        // update dots
        const allDots = dots.querySelectorAll('.carousel-dot');
        allDots.forEach((dot, i) => dot.classList.toggle('active', i === index));
      }

      function prev() {
        index = Math.max(0, index - 1);
        update();
      }
      function next() {
        index = Math.min(slidesCount - 1, index + 1);
        update();
      }

      // Button events
      btnLeft.addEventListener('click', prev);
      btnRight.addEventListener('click', next);

      // Dot clicks
      dots.addEventListener('click', (e) => {
        const dot = e.target.closest('.carousel-dot');
        if(!dot) return;
        index = Number(dot.dataset.index);
        update();
      });

      // Resize observer to keep track width correct
      const ro = new ResizeObserver(() => update());
      ro.observe(wrapper);

      // Touch events for swipe
      track.addEventListener('touchstart', (e) => {
        if(e.touches.length !== 1) return;
        isDragging = true;
        startX = e.touches[0].clientX;
        track.style.transition = 'none';
      }, {passive:true});

      track.addEventListener('touchmove', (e) => {
        if(!isDragging) return;
        const dx = e.touches[0].clientX - startX;
        const width = wrapper.clientWidth;
        track.style.transform = `translateX(${currentTranslate + dx}px)`;
      }, {passive:true});

      track.addEventListener('touchend', (e) => {
        if(!isDragging) return;
        isDragging = false;
        track.style.transition = '';
        const dx = (e.changedTouches && e.changedTouches[0]) ? (e.changedTouches[0].clientX - startX) : 0;
        const width = wrapper.clientWidth;
        // threshold: 20% of width
        if(dx > width * 0.2) {
          index = Math.max(0, index - 1);
        } else if(dx < -width * 0.2) {
          index = Math.min(slidesCount - 1, index + 1);
        }
        update();
      });

      // Mouse drag support (desktop)
      let mouseDown = false;
      let mouseStartX = 0;
      track.addEventListener('mousedown', (e) => {
        mouseDown = true;
        mouseStartX = e.clientX;
        track.style.transition = 'none';
        e.preventDefault();
      });
      window.addEventListener('mousemove', (e) => {
        if(!mouseDown) return;
        const dx = e.clientX - mouseStartX;
        track.style.transform = `translateX(${currentTranslate + dx}px)`;
      });
      window.addEventListener('mouseup', (e) => {
        if(!mouseDown) return;
        mouseDown = false;
        track.style.transition = '';
        const dx = e.clientX - mouseStartX;
        const width = wrapper.clientWidth;
        if(dx > width * 0.2) index = Math.max(0, index - 1);
        else if(dx < -width * 0.2) index = Math.min(slidesCount - 1, index + 1);
        update();
      });

      // Keyboard navigation
      wrapper.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowLeft') prev();
        if(e.key === 'ArrowRight') next();
      });

      // ensure wrapper is focusable for keyboard
      wrapper.tabIndex = 0;

      // initial update
      setTimeout(update, 0);

      return wrapper;
    }

    function renderProduct(product){
      const container = document.getElementById('productContainer');
      if(!product){
        container.innerHTML = '<div style="color:var(--muted)">Product not found. <a href="index.html">Back to shop</a></div>';
        return;
      }

      // Build carousel (use images array if present, otherwise fallback to single img)
      const images = Array.isArray(product.images) && product.images.length ? product.images : [product.img];

      // Create DOM structure
      container.innerHTML = `
        <div class="product-image"></div>
        <div class="product-info">
          <h1>${product.title}</h1>
          <p class="muted">${product.short}</p>
          <div style="margin-top:12px;font-weight:700;color:var(--accent);font-size:1.25rem">$${product.price}</div>
          <ul class="specs">${product.specs.map(s=>`<li>• ${s}</li>`).join('')}</ul>
          <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn primary" id="whatsappBtn" href="#" target="_blank" rel="noopener">Inquire on WhatsApp</a>
            <a class="btn" id="telegramBtn" href="#" target="_blank" rel="noopener">Inquire on Telegram</a>
            <div style="align-self:center;color:var(--muted)">Discord: <strong style="color:#fff">${DISCORD_HANDLE}</strong></div>
          </div>
          <p style="margin-top:12px;color:var(--muted)">Shipping estimate: <strong>7–14 days</strong>. Import fees may apply.</p>
        </div>
      `;

      // Insert carousel into .product-image
      const imageContainer = container.querySelector('.product-image');
      const carousel = createCarousel(images);
      imageContainer.appendChild(carousel);

      // Wire contact buttons
      const whatsappBtn = document.getElementById('whatsappBtn');
      const telegramBtn = document.getElementById('telegramBtn');
      if(whatsappBtn) whatsappBtn.href = whatsappLink(product);
      if(telegramBtn) telegramBtn.href = telegramLink();

      // Accessibility: focus carousel for keyboard navigation
      carousel.focus();
    }

    const id = getQueryParam('id');
    const product = products.find(p=>p.id === id);
    renderProduct(product);
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
